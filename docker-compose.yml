services:
    redis:
        image: redis:7.2-alpine
        container_name: template-redis
        ports:
            - "6379:6379"
        volumes:
            - redisdata:/data
        command: ["redis-server", "--appendonly", "yes", "--requirepass", "template"]
        logging:
            driver: "json-file"
            options:
                max-size: "10m"
                max-file: "3"
        healthcheck:
            test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
            interval: 10s
            timeout: 5s
            retries: 5

    app:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: template-app
        env_file:
            - .env
        environment:
            # Override Redis host for Docker networking
            - REDIS_HOST=redis
            - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
        ports:
            - "${PORT:-3001}:${PORT:-3001}"
        depends_on:
            redis:
                condition: service_healthy

volumes:
    redisdata:
